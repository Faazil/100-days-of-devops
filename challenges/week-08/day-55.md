# Challenge 55: Kubernetes Sidecar Containers

## üìä Metadata
- **Day**: 55
- **Week**: 8
- **Day in Week**: 6/7
- **Category**: Docker
- **Difficulty**: ‚≠ê‚≠ê Intermediate
- **Estimated Time**: 20-30 minutes

---

## üéØ Challenge Description

We have a web server container running the nginx image. The access and error logs generated by the web server are not critical enough to be placed on a persistent volume. However, Nautilus developers need access to the last 24 hours of logs so that they can trace issues and bugs. Therefore, we need to ship the access and error logs for the web server to a log-aggregation service. Following the separation of concerns principle, we implement the Sidecar pattern by deploying a second container that ships the error and access logs from nginx. Nginx does one thing, and it does it well‚Äîserving web pages. The second container also specializes in its task‚Äîshipping logs. Since containers are running on the same Pod, we can use a shared emptyDir volume to read and write logs.

- Create a pod named `webserver`.

- Create an emptyDir volume `shared-logs`.

- Create two containers from `nginx` and `ubuntu` images with latest tag only and remember to mention tag i.e `nginx:latest`, nginx container name should be `nginx-container` and ubuntu container name should be `sidecar-container` on webserver pod.

- Add command on `sidecar-container`

    ```sh
    "sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"
    ```

- Mount the volume `shared-logs` on both containers at location `/var/log/nginx`, all containers should be up and running.

> Note: The kubectl utility on jump_host has been configured to work with the kubernetes cluster.


## üìã Prerequisites

> ‚ö†Ô∏è **Important**: This challenge must be completed on **[KodeKloud Engineer](https://kodekloud.com/kodekloud-engineer)**. You'll need to sign up (free) to access the lab environment with pre-configured servers and infrastructure.

**What KodeKloud Provides:**
- ‚úÖ Pre-configured lab environment
- ‚úÖ Docker installed and configured
- ‚úÖ Necessary access and permissions
- ‚úÖ Automated validation of your solution

**What You Need to Know:**
- **Command Line Tools**: `docker`, `docker run`, `docker ps`, `docker build`, `docker exec`
- **Key Concepts**:
  - Container vs Image distinction
  - Container lifecycle management
  - Docker networking fundamentals
  - Volume mounting and persistence
- **Environment**: Docker installed and running

**Foundation from Earlier Challenges:**
- Day 45: Resolve Dockerfile Issues (recommended)
- Day 46: Deploy an App on Docker Containers (recommended)
- Day 47: Docker Python App (recommended)

**Required Skills:**
- ‚úÖ Build Docker images from Dockerfiles
- ‚úÖ Run and manage containers
- ‚úÖ Use port mapping and volumes
- ‚úÖ Execute commands in running containers

---

**üîó Learn More**: [KodeKloud 100 Days of DevOps](https://kodekloud.com/kodekloud-engineer/100-days-of-devops)

## Steps

1. Create a `k3s-pod.yml` using this [YAML file](../files/k3s-sidecar-containers-055.yaml)

2. Create pod

    ```bash
    kubectl apply -f k3s-pod.yml
    ```

3. Verify pod is running

    ```bash
    kubectl get pods

## Good to Know?

### Sidecar Pattern

- **Purpose**: Helper container alongside main application
- **Separation of Concerns**: Each container has specific responsibility
- **Shared Resources**: Share network, storage, and lifecycle
- **Common Use Cases**: Logging, monitoring, proxying, data sync

### Log Aggregation

- **Log Shipping**: Sidecar reads and forwards logs
- **Centralized Logging**: Send logs to central logging system
- **Log Processing**: Parse, filter, and transform logs
- **Multiple Sources**: Collect from different log files

### Sidecar Benefits

- **Modularity**: Separate concerns into different containers
- **Reusability**: Sidecar containers can be reused across applications
- **Independent Updates**: Update sidecar without affecting main app
- **Resource Isolation**: Separate resource limits and requests

### Implementation Patterns

- **Shared Volumes**: Use emptyDir for file sharing
- **Network Sharing**: Containers share localhost network
- **Lifecycle Management**: Containers start/stop together
- **Health Monitoring**: Monitor both main and sidecar containers

---

## ‚úÖ Verification

After completing the challenge, verify your solution by:

1. **Testing the implementation**
   - Run all commands from the solution
   - Check for any error messages

2. **Validating the results**
   - Ensure all requirements are met
   - Test edge cases if applicable

3. **Clean up (if needed)**
   - Remove temporary files
   - Reset any test configurations

---

## üìö Learning Notes

### Key Concepts

This challenge covers the following concepts:
- Practical application of Docker skills
- Real-world DevOps scenarios
- Best practices for production environments

### Common Pitfalls

- ‚ö†Ô∏è **Permissions**: Ensure you have the necessary permissions to execute commands
- ‚ö†Ô∏è **Syntax**: Double-check command syntax and flags
- ‚ö†Ô∏è **Environment**: Verify you're working in the correct environment/server

### Best Practices

- ‚úÖ Always verify changes before marking as complete
- ‚úÖ Test your solution in a safe environment first
- ‚úÖ Document any deviations from the standard approach
- ‚úÖ Keep security in mind for all configurations

---

## üîó Related Challenges

- **‚Üê Previous**: [Day 54 - Kubernetes Shared Volumes](./day-54.md)
- **Next ‚Üí**: [Day 56 - Deploy Nginx Web Server on Kubernetes Cluster](../week-08/day-56.md)

### Similar Challenges (Docker)
- [Day 45 - Resolve Dockerfile Issues](../week-07/day-45.md)
- [Day 46 - Deploy an App on Docker Containers](../week-07/day-46.md)
- [Day 47 - Docker Python App](../week-07/day-47.md)

---

## üìñ Additional Resources

- [KodeKloud Official Documentation](https://kodekloud.com)
- [Official Technology Documentation](#)
- [Community Discussions](#)

---

## üéì Knowledge Check

After completing this challenge, you should be able to:
- [ ] Understand the problem statement clearly
- [ ] Implement the solution independently
- [ ] Verify the solution works correctly
- [ ] Explain the concepts to others
- [ ] Apply these skills to similar problems

---

**Challenge Source**: KodeKloud 100 Days of DevOps
**Difficulty**: {get_difficulty_emoji(day)}
**Category**: {task_info['category']}

---

**Track your progress**: After completing this challenge, mark it as done:
```bash
python3 ../../tools/progress.py --complete {day}
```

